<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Edge</title>
    {% load static %}
    <script type="text/javascript" src="{% static 'movie_edge/d3.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/grid_interactions.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/constants.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/plotting.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/bokeh-1.4.0.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/bokeh-api-1.4.0.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/bokeh-tables-1.4.0.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'movie_edge/bokeh-widgets-1.4.0.min.js' %}"></script>

    <style>
        .grid {
            display: grid;
            grid-gap: 10px;
            grid-template-columns: repeat(3, 200px);
            grid-template-rows: repeat(3, 350px);
            grid-auto-flow: column;
            width: 30%;
            background: gray;
            float: left;
        }

        .buttonSubmit {
            height: 64px;
            width: 128px;
        }

        .buttonGetRandom {
            height: 64px;
            width: 128px;
        }

        .bk-root {
            width: 70%;
            float: right;
            background: darkgray;
        }

        .scatter {
            fill: steelblue;
            stroke: #000;
        }

        body {
            overflow-x: hidden;
            overflow-y: hidden
        }

    </style>
</head>
<body>
<button class="buttonSubmit" type="button" onclick="buttonClickSubmit(fetchURL)">
    Click me for movie recommendations!
</button>
<button class="buttonGetRandom" type="button" onclick="buttonClickGetRandom(fetchURL)">
    Click on me for some more randomness!
</button>
<br>
<br>
<!--https://gridbyexample.com/examples/code/example18.html-->
<div class="container">
    <div class="grid" id="grid"></div>
    <div class="graph" id="graph"></div>
</div>
{#Begin: super necessary! Else, disable CSRF Protection in views.py #}
{% csrf_token %}
{#End: super necessary! Else, disable CSRF Protection in views.py #}
<script>
    // https://stackoverflow.com/questions/38654599/django-best-way-to-pass-data-to-javascript
    const tableData = JSON.parse('{{ table_data|safe }}');
    console.log(tableData);
    const x_min = parseFloat(tableData['L5x__min']);
    const x_max = parseFloat(tableData['L5x__max']);
    const y_min = parseFloat(tableData['L5y__min']);
    const y_max = parseFloat(tableData['L5y__max']);
    const decoder = tableData['decoder'];
    let nineChoices = tableData['random_nine'];
    const width = 0.7 * window.innerWidth;
    const height = window.innerHeight;
    const data = tableData['data'].map(inputFormat);
    const fetchURL = "{% url 'movie_edge:query_recommendations' %}";
    gridNine(nineChoices);
    // https://docs.bokeh.org/en/latest/docs/user_guide/bokehjs.html
    // create some data and a ColumnDataSource
    const plt = Bokeh.Plotting;
    const x = data.map(function(v){return v[X]});
    const y = data.map(function(v){return v[Y]});
    const color = data.map(function(v){ return v[COLOR]});
    const source = new Bokeh.ColumnDataSource({data: {'x': x, 'y': y, 'color': color}});

    const tools = "pan,crosshair,wheel_zoom,box_zoom,reset,save";
    let xdr = new Bokeh.Range1d({ start: x_min, end: x_max });
    let ydr = new Bokeh.Range1d({ start: y_min, end: y_max });
    const p = plt.figure({
        title: "Colorful Scatter",
        tools: tools,
        x_range: xdr,
        y_range: ydr,
    });

    // call the circle glyph method to add some circle glyphs
    const circles = p.circle({ field: "x" }, { field: "y" }, {
        source: source,
        fill_color: {field: "color"},
        line_color: {field: "color"},
    });

    // show the plot
    new_plot = plt.show(p);

    // This lets us *dynamically* resize the visible area!
    // No re-render necessary.
    newXmin = 10;
    newXmax = 20;
    xdr.start = newXmin;
    xdr.end = newXmax;

</script>
</body>
</html>